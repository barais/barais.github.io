
<!DOCTYPE HTML>
<html lang="en">

<head>
<meta charset="utf-8">
<!-- <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Olivier Barais">
<link rel="author" href="https://plus.google.com/+OlivierBarais">
 
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/main.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<style>body {
    padding-top: 60px;
  }
  @media (max-width: 979px) {
    body {
      padding-top: 60px;
    }
  }
</style>

<title>Deploying openvpn on top of raspberry pi with docker</title>



<!-- Add custom CSS here -->

<!-- <link rel="shortcut icon" href="favicon.ico"> -->
<link rel="icon" href="/favicon.ico">


<!-- Test -->

</head>

<body>

    	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
				</button>
                <a class="navbar-brand" href="/">olivier.barais</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse navbar-right navbar-ex1-collapse">
				<ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
					<li><a href="/publications/">Publications</a></li>
					<li><a href="/teaching/">Teaching</a></li>
                    <li><a href="/research/">Research</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/photos/">Photos</a></li>
                    <li><a href="/contact/">Contact</a></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>


    <div class="container">
        <div class="row">
            <div class="col-md-8">
                               <!-- the actual blog post: title/author/date/content -->
                <h1> Deploying openvpn on top of raspberry pi with docker </h1>
                    <p class="lead">by <a href="/contact/">Olivier Barais</a> &nbsp;&nbsp;&nbsp;
                        
                            <a href="/blog/categories/docker/"><span class="label label-primary">docker</span></a>
                            &nbsp;
                        
                            <a href="/blog/categories/rpi/"><span class="label label-primary">rpi</span></a>
                            &nbsp;
                        
                            <a href="/blog/categories/raspberrypi/"><span class="label label-primary">raspberrypi</span></a>
                            &nbsp;
                        
                            <a href="/blog/categories/raspberry/"><span class="label label-primary">raspberry</span></a>
                            &nbsp;
                        
                    </p>
                        <span class="glyphicon glyphicon-time"></span> Posted 2017.02.07 
                        
                            &mdash; Rennes, France
                        

                <hr>
                
                <p>With the emergence of cloud offers with arm based server, it is convenient to be able to deploy vpn server on top of these platforms. For example Scaleway is a simple, scalable cloud platform. It’s the a platform where you can start x86 64bit and ARM BareMetal servers from a unique and simple graphical interface but also through API. Next you can use docker to deploy your micro-services. In this blog post, I just summarize how you can deploy your own openvpn server.</p>

<!--more-->

<h2 id="intialize-the-container">Intialize the container</h2>

<p>Pick a name for the $OVPN_DATA data volume container, it will be created automatically.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">OVPN_DATA</span><span class="o">=</span><span class="s2">"ovpn-data"</span>
</code></pre></div></div>

<p>Initialize the <code class="highlighter-rouge">$OVPN_DATA</code> container that will hold the configuration files and certificates</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker volume create <span class="nt">--name</span> <span class="nv">$OVPN_DATA</span>
docker run <span class="nt">-v</span> <span class="nv">$OVPN_DATA</span>:/etc/openvpn <span class="nt">--rm</span> giggio/openvpn-arm ovpn_genconfig <span class="nt">-u</span> udp://VPN.SERVERNAME.COM
docker run <span class="nt">-v</span> <span class="nv">$OVPN_DATA</span>:/etc/openvpn <span class="nt">--rm</span> <span class="nt">-it</span> giggio/openvpn-arm ovpn_initpki nopass
</code></pre></div></div>

<p>Start OpenVPN server process</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-v</span> <span class="nv">$OVPN_DATA</span>:/etc/openvpn <span class="nt">-d</span> <span class="nt">--name</span> openvpn <span class="nt">-p</span> 1194:1194/udp <span class="nt">--cap-add</span><span class="o">=</span>NET_ADMIN giggio/openvpn-arm
</code></pre></div></div>

<p>Generate a client certificate without a passphrase</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-v</span> <span class="nv">$OVPN_DATA</span>:/etc/openvpn <span class="nt">--rm</span> <span class="nt">-it</span> giggio/openvpn-arm easyrsa build-client-full CLIENTNAME nopass
</code></pre></div></div>

<p>Retrieve the client configuration with embedded certificates</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-v</span> <span class="nv">$OVPN_DATA</span>:/etc/openvpn <span class="nt">--rm</span> giggio/openvpn-arm ovpn_getclient CLIENTNAME <span class="o">&gt;</span> CLIENTNAME.ovpn
</code></pre></div></div>

<h2 id="running-a-second-fallback-tcp-container">Running a Second Fallback TCP Container</h2>

<h3 id="tcp-vs-udp---pros--cons">TCP vs. UDP - Pros &amp; Cons</h3>

<p>By default, OpenVPN is configured to use the UDP protocol. Because UDP incurs minimal protocol overhead (for example, no acknowledgment is required upon successful packet receipt), it can sometimes result in slightly faster throughput. However, in situations where VPN service is needed over an unreliable connection, the user experience can benefit from the extra diagnostic features of the TCP protocol.</p>

<p>As an example, users connecting from an airplane wifi network may experience high packet drop rates, where the error detection and sliding window control of TCP can more readily adjust to the inconsistent connection.</p>

<p>Another example would be trying to open a VPN connection from within a very restrictive network. In some cases port 1194, or even UDP traffic on any port, may be restricted by network policy. Because TCP traffic on port 443 is used for normal TLS (https) web browsing, it is very unlikely to be blocked.</p>

<p>Instead of choosing between UDP and TCP, you can use both. A single instance of OpenVPN can only listen for a single protocol on a single port, but this image makes it easy to run two instances simultaneously. After building, configuring, and starting a standard container listening for UDP traffic on 1194, you can start a second container listening for tcp traffic on port 443:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">OVPN_DATA</span><span class="o">=</span><span class="s2">"ovpn-data"</span>
docker run <span class="nt">-v</span> <span class="nv">$OVPN_DATA</span>:/etc/openvpn <span class="nt">-d</span> <span class="nt">-p</span> 443:1194/tcp <span class="nt">--privileged</span> giggio/openvpn-arm ovpn_run <span class="nt">--proto</span> tcp
</code></pre></div></div>

<p>ovpn_run will load all the values from the default config file, and –proto tcp will override the protocol setting.</p>

<p>This allows you to use UDP most of the time, but fall back to TCP on the rare occasion that you need it.</p>

<p>Note that you will need to configure client connections manually. At this time it is not possible to generate a client config that will automatically fall back to the TCP connection.</p>

<h2 id="importing-openvpn-configuration-in-your-linux-client">Importing openvpn configuration in your linux client</h2>

<p>Copy the generating ovpn file to your client.</p>

<p>If you use network manager, you can import this configuration file.</p>

<p>Open .ovpn file with a text editor.</p>

<p>And change lines that looks like</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote VPN.SERVERNAME.COM 1194  udp
</code></pre></div></div>

<p>to</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote VPN.SERVERNAME.COM 
port 1194 
proto udp
</code></pre></div></div>

<p>for connecting to tcp.</p>

<p>And change it to</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>remote VPN.SERVERNAME.COM
port 443
proto tcp
</code></pre></div></div>

<p>See <a href="http://askubuntu.com/questions/760345/cannot-import-saved-openvpn-configuration-file-in-ubuntu-16-04-lts">here</a> for more information.</p>

<h2 id="doing-the-same-for-x64-processor">Doing the same for x64 processor</h2>

<p>You can do exactly the same on X64 processor in replacing <code class="highlighter-rouge">giggio/openvpn-arm</code> with <code class="highlighter-rouge">kylemanna/openvpn</code></p>

<h2 id="source">Source</h2>

<ul>
  <li><a href="https://github.com/giggio/docker-openvpn-arm">https://github.com/giggio/docker-openvpn-arm</a></li>
  <li><a href="https://github.com/kylemanna/docker-openvpn/blob/master/docs/tcp.md">https://github.com/kylemanna/docker-openvpn/blob/master/docs/tcp.md</a></li>
  <li><a href="https://github.com/kylemanna/docker-openvpn/tree/master/docs">https://github.com/kylemanna/docker-openvpn/tree/master/docs</a></li>
</ul>


                
                <!-- the comment box -->
<!--                 <div class="well">
                    <h4>Leave a Comment:</h4>
                    <form role="form">
                        <div class="form-group">
                            <textarea class="form-control" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div> -->

                <!-- the comments -->
<!--                 <hr>
 --><!--                 <h3>Start Bootstrap
                    <small>9:41 PM on August 24, 2013</small>
                </h3>
                <p>This has to be the worst blog post I have ever read. It simply makes no sense. You start off by talking about space or something, then you randomly start babbling about cupcakes, and you end off with random fish names.</p>

                <h3>Start Bootstrap
                    <small>9:47 PM on August 24, 2013</small>
                </h3>
                <p>Don't listen to this guy, any blog with the categories 'dinosaurs, spaceships, fried foods, wild animals, alien abductions, business casual, robots, and fireworks' has true potential.</p> -->

<!--             <div class="row"> -->
<!--                 % include well.html %} -->
<!--             </div> -->

<!--             </div> -->
<!--             % include well.html %} -->
            

            </div>
            <div class="col-md-4">
                <!-- <div class="col-md-4"> -->
    <!--              
    <div class="well">
        <h4>Blog Search</h4>
        <div class="input-group">
            <input type="text" class="form-control">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button">
                    <span class="glyphicon glyphicon-search"></span>
                </button>
            </span>
        </div>
    </div>
    -->

    

    <div class="well">
        <div class="row">
            <div class="col-md-6">
                <h4>Current Tags</h4>
                <ul class="list-unstyled">
                    
                    <li><a href="/blog/categories/docker/">docker</a></li> 
                    <li><a href="/blog/categories/rpi/">rpi</a></li> 
                    <li><a href="/blog/categories/raspberrypi/">raspberrypi</a></li> 
                    <li><a href="/blog/categories/raspberry/">raspberry</a></li> 
                </ul>
            </div>
        </div>
    </div>

    

    <div class="well">
        <div class="row">
            <div class="col-lg-6">
                <h4>All Tags</h4>
                <ul class="list-unstyled">
                    <li><a href="/blog/">All</a></li> 
                    <li><a href="/blog/categories/first-post/">first-post</a></li> 
                    <li><a href="/blog/categories/jekyll/">jekyll</a></li> 
                    <li><a href="/blog/categories/github-pages/">github-pages</a></li> 
                    <li><a href="/blog/categories/teaching/">teaching</a></li> 
                    <li><a href="/blog/categories/markdown/">markdown</a></li> 
                    <li><a href="/blog/categories/untidy/">untidy</a></li> 
                    <li><a href="/blog/categories/website/">website</a></li> 
                    <li><a href="/blog/categories/docker/">docker</a></li> 
                    <li><a href="/blog/categories/cloud/">cloud</a></li> 
                    <li><a href="/blog/categories/diversify/">diversify</a></li> 
                    <li><a href="/blog/categories/eclipse/">eclipse</a></li> 
                    <li><a href="/blog/categories/istic/">istic</a></li> 
                    <li><a href="/blog/categories/m2/">m2</a></li> 
                    <li><a href="/blog/categories/french/">french</a></li> 
                    <li><a href="/blog/categories/ensai/">ensai</a></li> 
                    <li><a href="/blog/categories/kevoree/">kevoree</a></li> 
                    <li><a href="/blog/categories/kevoreejs/">kevoreejs</a></li> 
                    <li><a href="/blog/categories/edison/">edison</a></li> 
                    <li><a href="/blog/categories/angularjs/">angularjs</a></li> 
                    <li><a href="/blog/categories/jquery/">jquery</a></li> 
                    <li><a href="/blog/categories/jhipster/">jhipster</a></li> 
                    <li><a href="/blog/categories/sdn/">sdn</a></li> 
                    <li><a href="/blog/categories/opendaylight/">opendaylight</a></li> 
                    <li><a href="/blog/categories/software engineering/">software engineering</a></li> 
                    <li><a href="/blog/categories/ejcp/">ejcp</a></li> 
                    <li><a href="/blog/categories/swarm/">swarm</a></li> 
                    <li><a href="/blog/categories/go-docker/">go-docker</a></li> 
                    <li><a href="/blog/categories/raspberry pi/">raspberry pi</a></li> 
                    <li><a href="/blog/categories/javascript/">javascript</a></li> 
                    <li><a href="/blog/categories/java/">java</a></li> 
                    <li><a href="/blog/categories/slides/">slides</a></li> 
                    <li><a href="/blog/categories/reveal.js/">reveal.js</a></li> 
                    <li><a href="/blog/categories/powerpoint/">powerpoint</a></li> 
                    <li><a href="/blog/categories/migration/">migration</a></li> 
                    <li><a href="/blog/categories/labfab/">labfab</a></li> 
                    <li><a href="/blog/categories/api-platform/">api-platform</a></li> 
                    <li><a href="/blog/categories/symfony3/">symfony3</a></li> 
                    <li><a href="/blog/categories/ng2/">ng2</a></li> 
                    <li><a href="/blog/categories/angularjs2/">angularjs2</a></li> 
                    <li><a href="/blog/categories/rpi/">rpi</a></li> 
                    <li><a href="/blog/categories/raspberrypi/">raspberrypi</a></li> 
                    <li><a href="/blog/categories/raspberry/">raspberry</a></li> 
                    <li><a href="/blog/categories/swagger/">swagger</a></li> 
                    <li><a href="/blog/categories/curl/">curl</a></li> 
                    <li><a href="/blog/categories/authentification/">authentification</a></li> 
                    <li><a href="/blog/categories/l1/">l1</a></li> 
                </ul>
            </div>
        </div>
    </div>

    <div class="well">
        <h4>Remark</h4>
        <p>Sorry, no comments enabled for now because I'm using a simple static site generator (maybe I'll try out disqus another day).</p>
        <p>
            But if you like what you see, send me an <a href="/contact/">email</a>.
        </p>
    </div>
<!-- </div> -->

            </div>
        </div>
    </div>

    <hr>

    <div class="banner"> 
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <!--                     <h2>You can check me out on</h2> -->
                <h2>Find me on</h2>
            </div>
            <div class="col-lg-9">
                <ul class="list-inline banner-social-buttons">
                    <li><a href="http://www.linkedin.com/in/olivierbarais" class="btn btn-default btn-lg"><i class="fa fa-linkedin-square fa-fw"></i>
                            <span class="network-name">Linkedin</span></a></li>
                    <li><a href="https://github.com/barais" class="btn btn-default btn-lg"><i class="fa fa-github-square fa-fw"></i> <span
                            class="network-name">Github</span></a></li>
                    <li><a href="http://scholar.google.fr/citations?user=LV5i8X4AAAAJ&hl=en" class="btn btn-default btn-lg"><i
                            class="fa fa-search fa-fw"></i> <span class="network-name">Scholar</span></a></li>
                    <li><a href="https://www.google.com/+OlivierBarais?rel=author" class="btn btn-default btn-lg"><i
                            class="fa fa-google-plus-square fa-fw"></i> <span class="network-name">google+</span></a></li>
                    <li><a href="https://www.facebook.com/obarais" class="btn btn-default btn-lg"><i
                            class="fa fa-facebook-square fa-fw"></i> <span class="network-name">facebook</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->

</div>
<!-- /.banner -->

<footer>
    <div class="container">
        <div class="span12 pagination-centered" style="text-align: center">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li><a href="/">Home</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <!-- 						<li><a href="#about">About</a></li>
							<li class="footer-menu-divider">&sdot;</li>
	                    -->
                        <li><a href="/publications/">Publications</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/teaching/">Teaching</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/research/">Research</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/blog/">Blog</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/photos/">Photos</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/contact/">Contact</a></li>
                    </ul>

                    <p class="copyright text-muted small">
                        <a href="http://validator.w3.org/check?uri=referer"><img src="/img/valid-html401.png"
                            alt="Valid HTML 4.01 Frameset" height="20" width="57"></a> Built using <a href="http://jekyllrb.com/">Jekyll</a>, <a
                            href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://startbootstrap.com">Startbootstrap</a> from <a href="http://rudametw.github.io/">Walter Rudametkin's template</a>. All
                        source code available <a href="https://github.com/barais/barais.github.io"> here</a>. 
                    </p>
                </div>
            </div>
        </div>
    </div>
</footer>




</body>
</html>