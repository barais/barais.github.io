
<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8">
<!-- <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Olivier Barais">
<link rel="author" href="https://plus.google.com/+OlivierBarais">
 
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/main.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<style>body {
    padding-top: 60px;
  }
  @media (max-width: 979px) {
    body {
      padding-top: 60px;
    }
  }
</style>

<title>Using Go-Docker and Docker Swarm on top of a cluster of raspberry pi.</title>



<!-- Add custom CSS here -->

<!-- <link rel="shortcut icon" href="favicon.ico"> -->
<link rel="icon" href="/favicon.ico">


</head>

<body>

    	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
				</button>
                <a class="navbar-brand" href="/">olivier.barais</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse navbar-right navbar-ex1-collapse">
				<ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
					<li><a href="/publications/">Publications</a></li>
					<li><a href="/teaching/">Teaching</a></li>
                    <li><a href="/research/">Research</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/photos/">Photos</a></li>
                    <li><a href="/contact/">Contact</a></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>


    <div class="container">
        <div class="row">
            <div class="col-md-8">
                               <!-- the actual blog post: title/author/date/content -->
                <h1> Using Go-Docker and Docker Swarm on top of a cluster of raspberry pi. </h1>
                    <p class="lead">by <a href="/contact/">Olivier Barais</a> &nbsp;&nbsp;&nbsp;
                        
                            <a href="/blog/categories/docker/"><span class="label label-primary">docker</span></a>
                            &nbsp;
                        
                            <a href="/blog/categories/swarm/"><span class="label label-primary">swarm</span></a>
                            &nbsp;
                        
                            <a href="/blog/categories/go-docker/"><span class="label label-primary">go-docker</span></a>
                            &nbsp;
                        
                            <a href="/blog/categories/raspberry pi/"><span class="label label-primary">raspberry pi</span></a>
                            &nbsp;
                        
                    </p>
                        <span class="glyphicon glyphicon-time"></span> Posted 2016.03.24 
                        
                            &mdash; Rennes, France
                        

                <hr>
                
                <p>Lightweight containers technologies such as Docker are more and more adopted for deploying and managing micro-services architectures. Indeed, they hide a part of the complexity resulting from the language heterogeneity and the large choice of existing implementation frameworks that can be used to implement modern applications. Containers provide those benefits without introducing the general cost of the virtualization.</p>

<p>It exists lots of open-source configuration managers such as kubernetes, nomad, apache Mesos, or docker swarm to define and keep a standard modular applications in a consistent state and to dispatch its services on a cluster of remote nodes. Tools such as <a href="http://www.genouest.org/godocker/">Go-Docker</a> would complement these stacks to provide a batch computing/cluster management tool using Docker as execution/isolation system. It can be seen like Sun Grid Engine/Torque/.</p>

<blockquote>
  <p>Go-Docker acts as an additional layer above those tools on multiple user systems where users do not have Docker priviledges or knowledge.</p>
</blockquote>

<p>In this blog post, I will present some experiments to run Go-Docker on top of a cluster of raspberry pi.</p>

<!--more-->

<h1 id="step-0-check-your-hardware">Step 0: Check your hardware.</h1>

<p><img src="../../../img/IMG_20160228_122211519.jpg" alt="rpi cluster" /></p>

<p>Your need at least two raspberry PI and a router connected to Internet. I use one linksys WRT 54GL to connect to Internet and a 1Gb switch to connect my 16 Raspberry PI. The router provides a DHCP server for providing IP to my cluster.</p>

<h1 id="first-step-install-your-cluster-of-raspberry-pi">First step: Install your cluster of raspberry pi</h1>

<p>##Step 1.1: flash your image</p>

<p><a href="http://blog.hypriot.com/">Hypriot</a> and <a href="https://github.com/hypriot/cluster-lab">cluster-lab</a>  provide solutions to easily deploy your swarm on top of a raspberry pi.</p>

<p>First download the last image of a rspbian with a pre-install docker.</p>
<ul>
  <li><a href="https://downloads.hypriot.com/hypriot-rpi-20160306-192317.img.zip">Hypriot Docker Image for Raspberry Pi</a></li>
</ul>

<p>Get the <a href="https://github.com/hypriot/flash#installation">flash</a> tooling.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flash <span class="nt">--hostname</span> swarm-dc1-pi01  hypriot-rpi-20160306-192317.img.zip
flash <span class="nt">--hostname</span> swarm-dc1-pi02 hypriot-rpi-20160306-192317.img.zip
...
flash <span class="nt">--hostname</span> swarm-dc2-pi04  hypriot-rpi-20160306-192317.img.zip
</code></pre></div></div>

<p>##Step 1.2: Connect to your PI</p>

<p>Start your first Raspberry Pi. You can log in using ssh. The password is “hypriot”.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>getip<span class="o">()</span> <span class="o">{</span> <span class="o">(</span>traceroute <span class="nv">$1</span> 2&gt;&amp;1 | <span class="nb">head</span> <span class="nt">-n</span> 1 | <span class="nb">cut</span> <span class="nt">-d</span><span class="se">\(</span> <span class="nt">-f</span> 2 | <span class="nb">cut</span> <span class="nt">-d</span><span class="se">\)</span> <span class="nt">-f</span> 1<span class="o">)</span> <span class="o">}</span>

<span class="nv">IP_ADDRESS</span><span class="o">=</span><span class="k">$(</span>getip swarm-dc1-pi01.local<span class="k">)</span>

ssh root@<span class="nv">$IP_ADDRESS</span>

</code></pre></div></div>

<h2 id="step-13-check-your-time">Step 1.3: Check your time</h2>

<p>If the date of your raspberry pi is not up to date, your provider probably reject the ntp query.</p>

<p>You can test with another ntp server.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> service ntp stop
<span class="o">&gt;</span> ntpdate ntp.inria.fr
</code></pre></div></div>

<p>When you find an ntp server which is available from your Internet provider, Update your  /etc/default/ntpdate file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> nano <span class="nt">-w</span>   /etc/default/ntpdate  <span class="c"># add your ntp server to the list</span>
<span class="o">&gt;</span> service ntp stop
</code></pre></div></div>

<p>## Step 1.4: Check your Internet connection.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ping 8.8.8.8
</code></pre></div></div>

<h2 id="step-15-install-and-configure-cluster-lab">Step 1.5: Install and configure cluster lab</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nt">-y</span> upgrade <span class="o">&amp;&amp;</span> apt-get <span class="nb">install </span>hypriot-cluster-lab <span class="nt">-y</span>
</code></pre></div></div>

<p>Next you can configure, your cluster lab.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano <span class="nt">-w</span> /etc/cluster-lab/cluster.conf
<span class="c">#In my case, I Remove vlan, dhcp and set the Ip of the master node currently the IP of the first raspberry pi node. Indeed, my router provides a DHCP server for the cluster.</span>
</code></pre></div></div>

<p>Start your cluster lab.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service cluster-lab start
systemctl <span class="nb">enable </span>cluster-lab
</code></pre></div></div>

<h2 id="step-16-test-your-swarm">Step 1.6: Test your swarm.</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>getip<span class="o">()</span> <span class="o">{</span> <span class="o">(</span>traceroute <span class="nv">$1</span> 2&gt;&amp;1 | <span class="nb">head</span> <span class="nt">-n</span> 1 | <span class="nb">cut</span> <span class="nt">-d</span><span class="se">\(</span> <span class="nt">-f</span> 2 | <span class="nb">cut</span> <span class="nt">-d</span><span class="se">\)</span> <span class="nt">-f</span> 1<span class="o">)</span> <span class="o">}</span>
<span class="nv">IP_ADDRESS</span><span class="o">=</span><span class="k">$(</span>getip swarm-dc1-pi01.local<span class="k">)</span>
docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378 info
docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378 run hypriot/armhf-hello-world
<span class="nb">echo</span> <span class="nv">$IP_ADDRESS</span>:2378
</code></pre></div></div>

<h2 id="step-17-go-there-to-see-the-consul">Step 1.7: go there to see the consul.</h2>

<blockquote>
  <p><a href="http://{IP or hostname of the master node}:8500">http://{IP or hostname of the master node}:8500</a> # Consul UI</p>
</blockquote>

<h2 id="step-18-start-docker-ui">Step 1.8: start docker ui.</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378 run <span class="nt">-d</span> <span class="nt">-p</span> 9000:9000 <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==swarm-dc1-pi01"</span> <span class="nt">--name</span> dockerui hypriot/rpi-dockerui <span class="nt">-e</span> http://<span class="nv">$IP_ADDRESS</span>:2378
</code></pre></div></div>

<p>Go there to play with docker UI</p>

<blockquote>
  <p><a href="http://{IP or hostname of the master node}:9000">http://{IP or hostname of the master node}:9000</a> # Docker UI.</p>
</blockquote>

<h1 id="step-2-switch-on-all-your-pi--and-repeat-step-12-to-15">Step 2: Switch on all your PI  and Repeat step 1.2 to 1.5</h1>

<p>For each raspberry pi. Do not forget to  configure correctly your cluster lab.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano <span class="nt">-w</span> /etc/cluster-lab/cluster.conf
<span class="c">#In my case, I Remove vlan, dhcp and set the Ip of the master node currently the IP of the first raspberry pi node. Indeed, my router provides a DHCP server for the cluster.</span>
</code></pre></div></div>

<p>At the end, from your laptop you can check the docker swarm configuration. You can see the number of CPU that increase. You can also</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378 run <span class="nt">-d</span> <span class="nt">-p</span> 9000:9000 <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==swarm-dc1-pi01"</span> <span class="nt">--name</span> dockerui hypriot/rpi-dockerui <span class="nt">-e</span> http://<span class="nv">$IP_ADDRESS</span>:2378
</code></pre></div></div>

<p>Go there to play with docker UI</p>

<blockquote>
  <p><a href="http://{IP or hostname of the master node}:8500">http://{IP or hostname of the master node}:8500</a> # Consul UI</p>
</blockquote>

<blockquote>
  <p><a href="http://{IP or hostname of the master node}:9000">http://{IP or hostname of the master node}:9000</a> # Docker UI.</p>
</blockquote>

<h1 id="step-3-create-docker-image-for-go-docker-and-udpcast-can-be-skipped">Step 3: Create docker image for go docker and udpcast (can be skipped)</h1>

<h2 id="step-31-create-docker-image-for-udpcast">Step 3.1: Create docker image for udpcast</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM resin/rpi-raspbian:wheezy

MAINTAINER Olivier Barais &lt;barais@irisa.fr&gt;

LABEL status="Dockerfile in development"
LABEL description="Udpcast on top od alpine"


WORKDIR /

ENV admin="root"

RUN apt-get update &amp;&amp; \
apt-get -y upgrade &amp;&amp; \
apt-get install -y udpcast &amp;&amp; \
rm -rf /var/cache/apt/*.deb*

CMD ["/usr/bin/udp-sender"]

</code></pre></div></div>

<h2 id="step-32-create-docker-image-for-go-docker">Step 3.2: Create docker image for go-docker</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM resin/rpi-raspbian:wheezy
MAINTAINER Olivier Sallou &lt;olivier.sallou@irisa.fr&gt;

LABEL status="Dockerfile in development"
LABEL description="Batch scheduling system in containers. This image contains \
 all godocker components: web, scheduler and watchers. \
 Config should be overriden in /opt/godocker/go-d.ini \
 file. Default configuration does not provide mail and only fake \
 authentication."

EXPOSE 6543

WORKDIR /opt/go-docker

ENV admin="root"
ENV swarm_url="tcp://god-swarm:2375"

RUN apt-get update
RUN apt-get install -y git python-dev libldap2-dev gcc libsasl2-dev
RUN apt-get install -y python-setuptools apt-transport-https wget
RUN apt-get install -y openssl libffi-dev libssl-dev ca-certificates

RUN cd /opt &amp;&amp; git clone https://bitbucket.org/osallou/go-docker.git
RUN rm -f /opt/go-docker/plugins/mesos.*
RUN cd /opt &amp;&amp; git clone https://bitbucket.org/osallou/go-docker-web.git
RUN easy_install pip
RUN cd /opt/go-docker &amp;&amp; pip install -r requirements.txt
RUN cd /opt/go-docker &amp;&amp; python setup.py develop
RUN cd /opt/go-docker-web &amp;&amp; pip install -r requirements.txt
RUN cd /opt/go-docker-web &amp;&amp; python setup.py develop
RUN pip install godocker_cli
RUN cd /opt/go-docker-web &amp;&amp; cp production.ini.example production.ini
RUN cd /opt/go-docker-web &amp;&amp; sed -i 's;global_properties =.*;global_properties = /opt/go-docker/go-d.ini;g' production.ini
RUN cd /opt/go-docker-web &amp;&amp; sed -i 's;admin =.*;admin = '${admin}';g' production.ini
RUN cd /opt/go-docker &amp;&amp; cp go-d.ini.sample go-d.ini
RUN cd /opt/go-docker &amp;&amp; sed -i "s;plugins_dir:.*;plugins_dir: '/opt/go-docker/plugins';g" go-d.ini
RUN cd /opt/go-docker &amp;&amp; sed -i "s;shared_dir:.*;shared_dir: '/opt/godshared';g" go-d.ini
RUN cd /opt/go-docker &amp;&amp; sed -i "s;mongo_url:.*;mongo_url:'mongodb://god-mongo:27017';g" go-d.ini
RUN cd /opt/go-docker &amp;&amp; sed -i "s;redis_host:.*;redis_host:'god-redis';g" go-d.ini
RUN cd /opt/go-docker &amp;&amp; sed -i "s;influxdb_host:.*;influxdb_host: None;g" go-d.ini
RUN cd /opt/go-docker &amp;&amp; sed -i "s;prometheus_exporter:.*;prometheus_exporter: 'god-web:6543';g" go-d.ini
RUN cd /opt/go-docker &amp;&amp; sed -i "s;docker_url:.*;docker_url: '"${swarm_url}"';g" go-d.ini
RUN mkdir -p /var/log/go-docker

</code></pre></div></div>

<h1 id="step-4-install-go-docker">Step 4: Install Go Docker</h1>

<p>Mongodb and Redis are required. Either install them on a server, or get them in containers:</p>

<h2 id="step-41-run-god-mongo-god-redis">Step 4.1: Run god-mongo god-redis.</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>getip<span class="o">()</span> <span class="o">{</span> <span class="o">(</span>traceroute <span class="nv">$1</span> 2&gt;&amp;1 | <span class="nb">head</span> <span class="nt">-n</span> 1 | <span class="nb">cut</span> <span class="nt">-d</span><span class="se">\(</span> <span class="nt">-f</span> 2 | <span class="nb">cut</span> <span class="nt">-d</span><span class="se">\)</span> <span class="nt">-f</span> 1<span class="o">)</span> <span class="o">}</span>
<span class="nv">IP_ADDRESS</span><span class="o">=</span><span class="k">$(</span>getip swarm-dc1-pi01.local<span class="k">)</span>
docker  <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378 <span class="nb">rm </span>god-mongo god-redis god-web
docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378  run <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==swarm-dc1-pi01"</span> <span class="nt">--name</span> god-mongo <span class="nt">-d</span> rgreschner/rpi-raspbian-mongodb
docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378  run <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==swarm-dc1-pi01"</span> <span class="nt">--name</span> god-redis <span class="nt">-d</span> hypriot/rpi-redis
</code></pre></div></div>

<h2 id="step-42-running-components">Step 4.2: Running components</h2>

<p>Run the web server, interface is reachable at http://localhost:6543</p>

<p>Get the following config file</p>

<ul>
  <li><a href="../../../docs/godocker/go-d.ini">go-d.ini</a></li>
  <li><a href="../../../docs/godocker/production.ini">production.ini</a></li>
</ul>

<p>Warning: data shared directory (here /opt/godshared) must match
on host AND container as final job will end in a host container needing the same volume directory.
shared_dir parameter in go-d.ini configuration file must be changed accordingly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh root@<span class="nv">$IP_ADDRESS</span>
<span class="nb">mkdir</span> /opt/godshared
<span class="nb">mkdir</span> /tmp/vid
<span class="nb">exit</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378  run <span class="se">\</span>
  <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==swarm-dc1-pi01"</span><span class="se">\</span>
  <span class="nt">--name</span> god-web
  <span class="nt">--link</span> god-mongo:god-mongo  <span class="se">\</span>
  <span class="nt">--link</span> god-redis:god-redis  <span class="se">\</span>
  <span class="nt">-v</span> /opt/godshared:/opt/godshared <span class="se">\</span>
  <span class="nt">-v</span> path_to/go-d.ini:/opt/go-docker/go-d.ini <span class="se">\</span>
  <span class="nt">-v</span> path_to/production.ini:/opt/go-docker-web/production.ini <span class="se">\</span>
  <span class="nt">-p</span> 6543:6543 <span class="se">\</span>
  <span class="nt">-e</span> <span class="s2">"PYRAMID_ENV=prod"</span> <span class="se">\</span>
  barais/go-docker-rpi <span class="se">\</span>
  gunicorn <span class="nt">-p</span> godweb.pid <span class="nt">--log-config</span><span class="o">=</span>/opt/go-docker-web/production.ini <span class="nt">--paste</span> /opt/go-docker-web/production.ini
</code></pre></div></div>

<p>The first time only, you must initialize db etc…</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378 run <span class="se">\</span>
<span class="nt">--link</span> god-mongo:god-mongo <span class="se">\</span>
<span class="nt">--link</span> god-redis:god-redis <span class="se">\</span>
<span class="nt">-v</span> /opt/godshared:/opt/godshared <span class="se">\</span>
<span class="nt">-v</span> path_to/go-d.ini:/opt/go-docker/go-d.ini <span class="se">\</span>
<span class="nt">-e</span> <span class="nv">GOD_CONFIG</span><span class="o">=</span>/opt/go-docker/go-d.ini<span class="se">\</span>
 <span class="nt">--rm</span> <span class="se">\</span>
 <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==swarm-dc1-pi01"</span> <span class="se">\</span>
 barais/go-docker-rpi <span class="se">\</span>
 /usr/bin/python /opt/go-docker/go-d-scheduler.py init
</code></pre></div></div>

<p>Run one scheduler</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nt">-H</span>  <span class="nv">$IP_ADDRESS</span>:2378 run <span class="se">\</span>
  <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">--link</span> god-mongo:god-mongo  <span class="se">\</span>
  <span class="nt">--link</span> god-redis:god-redis  <span class="se">\</span>
  <span class="nt">--link</span> god-web:god-web <span class="se">\</span>
  <span class="nt">-v</span> /opt/godshared:/opt/godshared <span class="se">\</span>
  <span class="nt">-v</span> path_to/go-d.ini:/opt/go-docker/go-d.ini <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">GOD_CONFIG</span><span class="o">=</span>/opt/go-docker/go-d.ini<span class="se">\</span>
  <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==swarm-dc1-pi01"</span> <span class="se">\</span>
  barais/go-docker-rpi <span class="se">\</span>
  /usr/bin/python /opt/go-docker/go-d-scheduler.py run
</code></pre></div></div>

<p>Run one or many watchers (1 is enough test or medium size production)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nt">-H</span> <span class="nv">$IP_ADDRESS</span>:2378  run <span class="se">\</span>
  <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">--link</span> god-mongo:god-mongo  <span class="se">\</span>
  <span class="nt">--link</span> god-redis:god-redis  <span class="se">\</span>
  <span class="nt">--link</span> god-web:god-web <span class="se">\</span>
  <span class="nt">-v</span> /opt/godshared:/opt/godshared <span class="se">\</span>
  <span class="nt">-v</span> path_to/go-d.ini:/opt/go-docker/go-d.ini <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">GOD_CONFIG</span><span class="o">=</span>/opt/go-docker/go-d.ini<span class="se">\</span>
  <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==swarm-dc1-pi01"</span> <span class="se">\</span>
  barais/go-docker-rpi <span class="se">\</span>
  /usr/bin/python /opt/go-docker/go-d-watcher.py run
</code></pre></div></div>

<p>you can now go to <a href="http://$IP_ADDRESS:6543/">http://$IP_ADDRESS:6543/</a></p>

<p>login: <em>godocker</em>
pass: <em>admin</em></p>

<h1 id="step-5-create-docker-image-for-gstreamer">Step 5: Create docker image for gstreamer</h1>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM resin/rpi-raspbian:wheezy

MAINTAINER Olivier Barais &lt;barais@irisa.fr&gt;

LABEL status="Dockerfile in development"
LABEL description="gstreamer with hardware access"


WORKDIR /

ENV admin="root"

RUN apt-get update &amp;&amp; \
apt-get -y upgrade &amp;&amp; \
apt-get install gstreamer1.0-tools gstreamer1.0-omx  -y &amp;&amp; \
apt-get install gstreamer1.0-libav gstreamer1.0-fluendo-mp3 gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly  gstreamer1.0-plugins-good  gstreamer1.0-plugins-base  -y &amp;&amp; \
rm -rf /var/cache/apt/*.deb*

CMD ["gst-launch-1.0 -e filesrc location=$input.mp4 ! decodebin name=demux ! queue ! audioconvert ! audio/x-raw ! audiorate ! avenc_ac3 bitrate=320000 ! mux. mpegtsmux name=mux ! filesink location=\"$output.h264\" demux. ! queue ! videoconvert ! deinterlace ! omxh264enc target-bitrate=2000000 control-rate=1  ! \"video/x-h264,profile=high\" ! h264parse ! mux."]

</code></pre></div></div>

<h1 id="step-6-configure-all-docker-to-run-in-priviledge-mode">Step 6 configure all docker to run in priviledge mode</h1>

<p><a href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities">https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities</a></p>

<h1 id="step-7-define-your-workflow-from-sirius">Step 7: Define your workflow from Sirius</h1>

<p><a href="https://eclipse.org/sirius/">Sirius</a></p>

<h1 id="step-8-observe-your-execution-using-a-tool-based-on-the-graph-and-cadvisor">Step 8: Observe your execution using a tool based on the graph and CAdvisor.</h1>

<p><a href="https://github.com/the-grid/the-graph">the-graph</a></p>

<p>#Want to play with us</p>
<ul>
  <li>Join <a href="https://b-com.com/">B-COM</a> JiTter project. <a href="mailto:Christophe.DION@b-com.com;Antoine.CABOT@b-com.com;barais@irisa.fr">contact</a></li>
</ul>

                
                <!-- the comment box -->
<!--                 <div class="well">
                    <h4>Leave a Comment:</h4>
                    <form role="form">
                        <div class="form-group">
                            <textarea class="form-control" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div> -->

                <!-- the comments -->
<!--                 <hr>
 --><!--                 <h3>Start Bootstrap
                    <small>9:41 PM on August 24, 2013</small>
                </h3>
                <p>This has to be the worst blog post I have ever read. It simply makes no sense. You start off by talking about space or something, then you randomly start babbling about cupcakes, and you end off with random fish names.</p>

                <h3>Start Bootstrap
                    <small>9:47 PM on August 24, 2013</small>
                </h3>
                <p>Don't listen to this guy, any blog with the categories 'dinosaurs, spaceships, fried foods, wild animals, alien abductions, business casual, robots, and fireworks' has true potential.</p> -->

<!--             <div class="row"> -->
<!--                 % include well.html %} -->
<!--             </div> -->

<!--             </div> -->
<!--             % include well.html %} -->
            

            </div>
            <div class="col-md-4">
                <!-- <div class="col-md-4"> -->
    <!--              
    <div class="well">
        <h4>Blog Search</h4>
        <div class="input-group">
            <input type="text" class="form-control">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button">
                    <span class="glyphicon glyphicon-search"></span>
                </button>
            </span>
        </div>
    </div>
    -->

    

    <div class="well">
        <div class="row">
            <div class="col-md-6">
                <h4>Current Tags</h4>
                <ul class="list-unstyled">
                    
                    <li><a href="/blog/categories/docker/">docker</a></li> 
                    <li><a href="/blog/categories/swarm/">swarm</a></li> 
                    <li><a href="/blog/categories/go-docker/">go-docker</a></li> 
                    <li><a href="/blog/categories/raspberry pi/">raspberry pi</a></li> 
                </ul>
            </div>
        </div>
    </div>

    

    <div class="well">
        <div class="row">
            <div class="col-lg-6">
                <h4>All Tags</h4>
                <ul class="list-unstyled">
                    <li><a href="/blog/">All</a></li> 
                    <li><a href="/blog/categories/first-post/">first-post</a></li> 
                    <li><a href="/blog/categories/jekyll/">jekyll</a></li> 
                    <li><a href="/blog/categories/github-pages/">github-pages</a></li> 
                    <li><a href="/blog/categories/teaching/">teaching</a></li> 
                    <li><a href="/blog/categories/markdown/">markdown</a></li> 
                    <li><a href="/blog/categories/untidy/">untidy</a></li> 
                    <li><a href="/blog/categories/website/">website</a></li> 
                    <li><a href="/blog/categories/docker/">docker</a></li> 
                    <li><a href="/blog/categories/cloud/">cloud</a></li> 
                    <li><a href="/blog/categories/diversify/">diversify</a></li> 
                    <li><a href="/blog/categories/eclipse/">eclipse</a></li> 
                    <li><a href="/blog/categories/istic/">istic</a></li> 
                    <li><a href="/blog/categories/m2/">m2</a></li> 
                    <li><a href="/blog/categories/french/">french</a></li> 
                    <li><a href="/blog/categories/ensai/">ensai</a></li> 
                    <li><a href="/blog/categories/kevoree/">kevoree</a></li> 
                    <li><a href="/blog/categories/kevoreejs/">kevoreejs</a></li> 
                    <li><a href="/blog/categories/edison/">edison</a></li> 
                    <li><a href="/blog/categories/angularjs/">angularjs</a></li> 
                    <li><a href="/blog/categories/jquery/">jquery</a></li> 
                    <li><a href="/blog/categories/jhipster/">jhipster</a></li> 
                    <li><a href="/blog/categories/sdn/">sdn</a></li> 
                    <li><a href="/blog/categories/opendaylight/">opendaylight</a></li> 
                    <li><a href="/blog/categories/software engineering/">software engineering</a></li> 
                    <li><a href="/blog/categories/ejcp/">ejcp</a></li> 
                    <li><a href="/blog/categories/swarm/">swarm</a></li> 
                    <li><a href="/blog/categories/go-docker/">go-docker</a></li> 
                    <li><a href="/blog/categories/raspberry pi/">raspberry pi</a></li> 
                    <li><a href="/blog/categories/javascript/">javascript</a></li> 
                    <li><a href="/blog/categories/java/">java</a></li> 
                    <li><a href="/blog/categories/slides/">slides</a></li> 
                    <li><a href="/blog/categories/reveal.js/">reveal.js</a></li> 
                    <li><a href="/blog/categories/powerpoint/">powerpoint</a></li> 
                    <li><a href="/blog/categories/migration/">migration</a></li> 
                    <li><a href="/blog/categories/labfab/">labfab</a></li> 
                    <li><a href="/blog/categories/api-platform/">api-platform</a></li> 
                    <li><a href="/blog/categories/symfony3/">symfony3</a></li> 
                    <li><a href="/blog/categories/ng2/">ng2</a></li> 
                    <li><a href="/blog/categories/angularjs2/">angularjs2</a></li> 
                    <li><a href="/blog/categories/rpi/">rpi</a></li> 
                    <li><a href="/blog/categories/raspberrypi/">raspberrypi</a></li> 
                    <li><a href="/blog/categories/raspberry/">raspberry</a></li> 
                    <li><a href="/blog/categories/swagger/">swagger</a></li> 
                    <li><a href="/blog/categories/curl/">curl</a></li> 
                    <li><a href="/blog/categories/authentification/">authentification</a></li> 
                    <li><a href="/blog/categories/l1/">l1</a></li> 
                    <li><a href="/blog/categories/OpenWRT/">OpenWRT</a></li> 
                    <li><a href="/blog/categories/Camera/">Camera</a></li> 
                    <li><a href="/blog/categories/Canon/">Canon</a></li> 
                </ul>
            </div>
        </div>
    </div>

    <div class="well">
        <h4>Remark</h4>
        <p>Sorry, no comments enabled for now because I'm using a simple static site generator (maybe I'll try out disqus another day).</p>
        <p>
            But if you like what you see, send me an <a href="/contact/">email</a>.
        </p>
    </div>
<!-- </div> -->

            </div>
        </div>
    </div>

    <hr>

    <div class="banner"> 
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <!--                     <h2>You can check me out on</h2> -->
                <h2>Find me on</h2>
            </div>
            <div class="col-lg-9">
                <ul class="list-inline banner-social-buttons">
                    <li><a href="http://www.linkedin.com/in/olivierbarais" class="btn btn-default btn-lg"><i class="fa fa-linkedin-square fa-fw"></i>
                            <span class="network-name">Linkedin</span></a></li>
                    <li><a href="https://github.com/barais" class="btn btn-default btn-lg"><i class="fa fa-github-square fa-fw"></i> <span
                            class="network-name">Github</span></a></li>
                    <li><a href="http://scholar.google.fr/citations?user=LV5i8X4AAAAJ&hl=en" class="btn btn-default btn-lg"><i
                            class="fa fa-search fa-fw"></i> <span class="network-name">Scholar</span></a></li>
                    <li><a href="https://www.google.com/+OlivierBarais?rel=author" class="btn btn-default btn-lg"><i
                            class="fa fa-google-plus-square fa-fw"></i> <span class="network-name">google+</span></a></li>
                    <li><a href="https://www.facebook.com/obarais" class="btn btn-default btn-lg"><i
                            class="fa fa-facebook-square fa-fw"></i> <span class="network-name">facebook</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->

</div>
<!-- /.banner -->

<footer>
    <div class="container">
        <div class="span12 pagination-centered" style="text-align: center">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li><a href="/">Home</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <!-- 						<li><a href="#about">About</a></li>
							<li class="footer-menu-divider">&sdot;</li>
	                    -->
                        <li><a href="/publications/">Publications</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/teaching/">Teaching</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/research/">Research</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/blog/">Blog</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/photos/">Photos</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/contact/">Contact</a></li>
                    </ul>

                    <p class="copyright text-muted small">
                        <a href="http://validator.w3.org/check?uri=referer"><img src="/img/valid-html401.png"
                            alt="Valid HTML 4.01 Frameset" height="20" width="57"></a> Built using <a href="http://jekyllrb.com/">Jekyll</a>, <a
                            href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://startbootstrap.com">Startbootstrap</a> from <a href="http://rudametw.github.io/">Walter Rudametkin's template</a>. All
                        source code available <a href="https://github.com/barais/barais.github.io"> here</a>. 
                    </p>
                </div>
            </div>
        </div>
    </div>
</footer>




</body>
</html>