<p>I am just finishing the docker image to run <a href="https://github.com/maxleiko/mdms-ringojs">mdms</a> quickly.</p>

<p>To play with it, just pull the following images.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker pull barais/mdmsredis <span class="c">#contains the redis databases</span>
docker pull barais/mdmssosies <span class="c">#contains the sosies (it is big)</span>
docker pull barais/nginxsosies <span class="c">#contains nginx and the websocket server for displaying connection</span></code></pre></div>

<p>To create quickly a cluster of regular mdms worker</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="c">#start nginx</span>
<span class="nb">export </span><span class="nv">ID_REDIS</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmsredis /usr/bin/redis-server<span class="k">)</span>
<span class="nb">export </span><span class="nv">IP_REDIS</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_REDIS</span><span class="sb">`</span> 
<span class="c">#start some sosies</span>
<span class="c">#run just once</span>
<span class="nb">export </span><span class="nv">ID_SOSIES</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmssosies /bin/bash -xec <span class="s2">&quot;sed -i &quot;</span>s/172.17.0.8/<span class="nv">$IP_REDIS</span>/g<span class="s2">&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/tools/fakedb.js&quot;</span><span class="k">)</span>

<span class="c">#run for each sosies</span>

<span class="k">for</span> i in <span class="o">{</span>1..10<span class="o">}</span>
<span class="k">do</span>
	<span class="nb">export </span><span class="nv">ID_SOSIES</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmssosies /bin/bash -xec <span class="s2">&quot;sed -i &quot;</span>s/172.17.0.8/<span class="nv">$IP_REDIS</span>/g<span class="s2">&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/main.js&quot;</span><span class="k">)</span>
	<span class="nb">export </span><span class="nv">IP_SOSIES</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_SOSIES</span><span class="sb">`</span>
	<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$IPS_WORKER&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">export </span><span class="nv">IPS_WORKER</span><span class="o">=</span><span class="nv">$IP_SOSIES</span><span class="p">;</span> <span class="k">else</span> <span class="nb">export </span><span class="nv">IPS_WORKER</span><span class="o">=</span><span class="s2">&quot;$IP_SOSIES;$IPS_WORKER&quot;</span><span class="p">;</span> <span class="k">fi</span>  
<span class="k">done</span>

<span class="c">#start some nginx and websocket server</span>
<span class="nb">export </span><span class="nv">ID_NGINX</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/nginxsosies /main <span class="nv">$IPS_WORKER</span><span class="k">)</span> <span class="c">#you can add a second parameter for the public name of your website e.g. cloud.diversify.org</span>
<span class="nb">export </span><span class="nv">IP_NGINX</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_NGINX</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="nv">$IP_NGINX</span></code></pre></div>

<p>To create quickly a cluster of diversified mdms workers:</p>

<!--more-->

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="c">#start nginx</span>
<span class="nb">export </span><span class="nv">ID_REDIS</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmsredis /usr/bin/redis-server<span class="k">)</span>
<span class="nb">export </span><span class="nv">IP_REDIS</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_REDIS</span><span class="sb">`</span>

<span class="c">#start some sosies</span>
<span class="c">#run just once</span>
<span class="nb">export </span><span class="nv">ID_SOSIES</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmssosies /bin/bash -xec <span class="s2">&quot;sed -i &quot;</span>s/172.17.0.8/<span class="nv">$IP_REDIS</span>/g<span class="s2">&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/tools/fakedb.js&quot;</span><span class="k">)</span>

<span class="c">#run for each sosies</span>

<span class="k">for</span> i in <span class="o">{</span>factory_and_indirection_on_RhinoEnginerhino15 factory_and_indirection_on_RhinoEnginerhino16 factory_and_indirection_on_RhinoEnginerhino4 factory_and_indirection_on_RhinoEnginerhino5 factory_and_indirection_on_RhinoEnginerhino8 indirection_on_Streamrhino15 indirection_on_Streamrhino16 indirection_on_Streamrhino4 indirection_on_Streamrhino5 indirection_on_Streamrhino8<span class="o">}</span>
<span class="k">do</span>
	<span class="nb">export </span><span class="nv">ID_SOSIES</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmssosies /bin/bash -xec <span class="s2">&quot;sed -i &quot;</span>s/172.17.0.8/<span class="nv">$IP_REDIS</span>/g<span class="s2">&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/$i/bin/ringo /opt/mdms-ringojs/main.js&quot;</span><span class="k">)</span>
	<span class="nb">export </span><span class="nv">IP_SOSIES</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_SOSIES</span><span class="sb">`</span>
	<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$IPS_WORKER&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">export </span><span class="nv">IPS_WORKER</span><span class="o">=</span><span class="nv">$IP_SOSIES</span><span class="p">;</span> <span class="k">else</span> <span class="nb">export </span><span class="nv">IPS_WORKER</span><span class="o">=</span><span class="s2">&quot;$IP_SOSIES;$IPS_WORKER&quot;</span><span class="p">;</span> <span class="k">fi</span>  
<span class="k">done</span>

<span class="c">#start some nginx and websocket server</span>
<span class="nb">export </span><span class="nv">ID_NGINX</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/nginxsosies /main <span class="nv">$IPS_WORKER</span><span class="k">)</span> <span class="c">#you can add a second parameter for the public name of your website e.g. cloud.diversify.org</span>
<span class="nb">export </span><span class="nv">IP_NGINX</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_NGINX</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="nv">$IP_NGINX</span></code></pre></div>

<p>To mix, both of sosies and regular version</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="c">#!/bin/bash</span>
<span class="c">#start nginx</span>
<span class="nb">export </span><span class="nv">ID_REDIS</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmsredis /usr/bin/redis-server<span class="k">)</span>
<span class="nb">export </span><span class="nv">IP_REDIS</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_REDIS</span><span class="sb">`</span>

<span class="c">#start some sosies</span>
<span class="c">#run just once</span>
<span class="nb">export </span><span class="nv">ID_SOSIES</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmssosies /bin/bash -xec <span class="s2">&quot;sed -i &quot;</span>s/172.17.0.8/<span class="nv">$IP_REDIS</span>/g<span class="s2">&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/tools/fakedb.js&quot;</span><span class="k">)</span>

<span class="c">#run for each sosies</span>

<span class="k">for</span> i in <span class="o">{</span>1..10<span class="o">}</span>
<span class="k">do</span>
	<span class="nb">export </span><span class="nv">ID_SOSIES</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmssosies /bin/bash -xec <span class="s2">&quot;sed -i &quot;</span>s/172.17.0.8/<span class="nv">$IP_REDIS</span>/g<span class="s2">&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/main.js&quot;</span><span class="k">)</span>
	<span class="nb">export </span><span class="nv">IP_SOSIES</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_SOSIES</span><span class="sb">`</span>
	<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$IPS_WORKER&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">export </span><span class="nv">IPS_WORKER</span><span class="o">=</span><span class="nv">$IP_SOSIES</span><span class="p">;</span> <span class="k">else</span> <span class="nb">export </span><span class="nv">IPS_WORKER</span><span class="o">=</span><span class="s2">&quot;$IP_SOSIES;$IPS_WORKER&quot;</span><span class="p">;</span> <span class="k">fi</span>  
<span class="k">done</span>

<span class="k">for</span> i in <span class="o">{</span>factory_and_indirection_on_RhinoEnginerhino15 factory_and_indirection_on_RhinoEnginerhino16 factory_and_indirection_on_RhinoEnginerhino4 factory_and_indirection_on_RhinoEnginerhino5 factory_and_indirection_on_RhinoEnginerhino8 indirection_on_Streamrhino15 indirection_on_Streamrhino16 indirection_on_Streamrhino4 indirection_on_Streamrhino5 indirection_on_Streamrhino8<span class="o">}</span>
<span class="k">do</span>
	<span class="nb">export </span><span class="nv">ID_SOSIES</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/mdmssosies /bin/bash -xec <span class="s2">&quot;sed -i &quot;</span>s/172.17.0.8/<span class="nv">$IP_REDIS</span>/g<span class="s2">&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/$i/bin/ringo /opt/mdms-ringojs/main.js&quot;</span><span class="k">)</span>
	<span class="nb">export </span><span class="nv">IP_SOSIES</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_SOSIES</span><span class="sb">`</span>
	<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$IPS_WORKER&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">export </span><span class="nv">IPS_WORKER</span><span class="o">=</span><span class="nv">$IP_SOSIES</span><span class="p">;</span> <span class="k">else</span> <span class="nb">export </span><span class="nv">IPS_WORKER</span><span class="o">=</span><span class="s2">&quot;$IP_SOSIES;$IPS_WORKER&quot;</span><span class="p">;</span> <span class="k">fi</span>  
<span class="k">done</span>

<span class="c">#start some nginx and websocket server</span>
<span class="nb">export </span><span class="nv">ID_NGINX</span><span class="o">=</span><span class="k">$(</span>docker  run -i -d -t barais/nginxsosies /main <span class="nv">$IPS_WORKER</span><span class="k">)</span> <span class="c">#you can add a second parameter for the public name of your website e.g. cloud.diversify.org</span>
<span class="nb">export </span><span class="nv">IP_NGINX</span><span class="o">=</span><span class="sb">`</span>docker inspect --format<span class="o">=</span><span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> <span class="nv">$ID_NGINX</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="nv">$IP_NGINX</span></code></pre></div>

<p>To go quickly, shell script are <a href="/docs/diversify/diversify.tar.gz">there</a></p>

<p>if it is for a demo, you can switch quickly between version in doing:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker <span class="nb">kill</span> <span class="k">$(</span>docker ps -a -q<span class="k">)</span> <span class="c">#kill all the running containers</span>
diversify<span class="se">\ </span>docker1.sh <span class="c">#start mdms with 10 regular backends</span>
docker <span class="nb">kill</span> <span class="k">$(</span>docker ps -a -q<span class="k">)</span> <span class="c">#kill all the running containers</span>
diversify<span class="se">\ </span>docker2.sh <span class="c">#start mdms with 10 diversified backends</span>
docker <span class="nb">kill</span> <span class="k">$(</span>docker ps -a -q<span class="k">)</span> <span class="c">#kill all the running containers</span>
diversify<span class="se">\ </span>docker3.sh <span class="c">#start mdms with 10 diversified backends and 10 regular backends</span></code></pre></div>

<p>have fun ;)</p>

