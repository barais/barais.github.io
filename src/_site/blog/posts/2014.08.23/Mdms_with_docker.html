
<!DOCTYPE HTML>
<html lang="en">

<head>
<meta charset="utf-8">
<!-- <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Olivier Barais">
<link rel="author" href="https://plus.google.com/+OlivierBarais">

<title>Running MDMS and MDMS Diversified using docker</title>



<!-- Add custom CSS here -->
<!-- <link rel="stylesheet" href="/assets/main-58abab6103ee78e02cfcfa062233325f.css"> -->

<!-- <link rel="shortcut icon" href="favicon.ico"> -->
<link rel="icon" href="favicon.ico">


<!-- Test -->

</head>

<body>

    	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
				</button>
                <a class="navbar-brand" href="/">olivier.barais</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse navbar-right navbar-ex1-collapse">
				<ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
					<li><a href="/publications/">Publications</a></li>
					<li><a href="/teaching/">Teaching</a></li>
                    <li><a href="/research/">Research</a></li>
                    <li><a href="/blog/">Blog</a></li>
                    <li><a href="/photos/">Photos</a></li>
                    <li><a href="/contact/">Contact</a></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>


    <div class="container">
        <div class="row">
            <div class="col-md-8">
                               <!-- the actual blog post: title/author/date/content -->
                <h1> Running MDMS and MDMS Diversified using docker </h1>
                    <p class="lead">by <a href="/contact/">Olivier Barais</a> &nbsp;&nbsp;&nbsp;
                        
                            <a href="/blog/categories/docker/"><span class="label label-primary">docker</span></a>
                            &nbsp;
                        
                            <a href="/blog/categories/diversify/"><span class="label label-primary">diversify</span></a>
                            &nbsp;
                        
                    </p>
                        <span class="glyphicon glyphicon-time"></span> Posted 2014.08.23 
                        
                            &mdash; Rennes, France
                        

                <hr>
                
                <p>I am just finishing the docker image to run <a href="https://github.com/maxleiko/mdms-ringojs">mdms</a> quickly. </p>

<p>To play with it, just pull the following images. </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker pull barais/mdmsredis #contains the redis databases
docker pull barais/mdmssosies #contains the sosies (it is big)
docker pull barais/nginxsosies #contains nginx and the websocket server for displaying connection</code></pre></div>

<p>To create quickly a cluster of regular mdms worker </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">#!/bin/bash
#start nginx
export ID_REDIS=$(docker  run -i -d -t barais/mdmsredis /usr/bin/redis-server)
export IP_REDIS=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_REDIS` 
#start some sosies
#run just once
export ID_SOSIES=$(docker  run -i -d -t barais/mdmssosies /bin/bash -xec &quot;sed -i &quot;s/172.17.0.8/$IP_REDIS/g&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/tools/fakedb.js&quot;)

#run for each sosies

for i in {1..10}
do
    export ID_SOSIES=$(docker  run -i -d -t barais/mdmssosies /bin/bash -xec &quot;sed -i &quot;s/172.17.0.8/$IP_REDIS/g&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/main.js&quot;)
    export IP_SOSIES=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_SOSIES`
    if [ -z &quot;$IPS_WORKER&quot; ]; then export IPS_WORKER=$IP_SOSIES; else export IPS_WORKER=&quot;$IP_SOSIES;$IPS_WORKER&quot;; fi  
done

#start some nginx and websocket server
export ID_NGINX=$(docker  run -i -d -t barais/nginxsosies /main $IPS_WORKER) #you can add a second parameter for the public name of your website e.g. cloud.diversify.org
export IP_NGINX=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_NGINX`
echo $IP_NGINX</code></pre></div>

<p>To create quickly a cluster of diversified mdms workers:</p>

<!--more-->

<div class="highlight"><pre><code class="language-bash" data-lang="bash">#!/bin/bash
#start nginx
export ID_REDIS=$(docker  run -i -d -t barais/mdmsredis /usr/bin/redis-server)
export IP_REDIS=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_REDIS`

#start some sosies
#run just once
export ID_SOSIES=$(docker  run -i -d -t barais/mdmssosies /bin/bash -xec &quot;sed -i &quot;s/172.17.0.8/$IP_REDIS/g&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/tools/fakedb.js&quot;)

#run for each sosies

for i in {factory_and_indirection_on_RhinoEnginerhino15 factory_and_indirection_on_RhinoEnginerhino16 factory_and_indirection_on_RhinoEnginerhino4 factory_and_indirection_on_RhinoEnginerhino5 factory_and_indirection_on_RhinoEnginerhino8 indirection_on_Streamrhino15 indirection_on_Streamrhino16 indirection_on_Streamrhino4 indirection_on_Streamrhino5 indirection_on_Streamrhino8}
do
    export ID_SOSIES=$(docker  run -i -d -t barais/mdmssosies /bin/bash -xec &quot;sed -i &quot;s/172.17.0.8/$IP_REDIS/g&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/$i/bin/ringo /opt/mdms-ringojs/main.js&quot;)
    export IP_SOSIES=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_SOSIES`
    if [ -z &quot;$IPS_WORKER&quot; ]; then export IPS_WORKER=$IP_SOSIES; else export IPS_WORKER=&quot;$IP_SOSIES;$IPS_WORKER&quot;; fi  
done

#start some nginx and websocket server
export ID_NGINX=$(docker  run -i -d -t barais/nginxsosies /main $IPS_WORKER) #you can add a second parameter for the public name of your website e.g. cloud.diversify.org
export IP_NGINX=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_NGINX`
echo $IP_NGINX</code></pre></div>

<p>To mix, both of sosies and regular version</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">#!/bin/bash
#!/bin/bash
#start nginx
export ID_REDIS=$(docker  run -i -d -t barais/mdmsredis /usr/bin/redis-server)
export IP_REDIS=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_REDIS`

#start some sosies
#run just once
export ID_SOSIES=$(docker  run -i -d -t barais/mdmssosies /bin/bash -xec &quot;sed -i &quot;s/172.17.0.8/$IP_REDIS/g&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/tools/fakedb.js&quot;)

#run for each sosies

for i in {1..10}
do
    export ID_SOSIES=$(docker  run -i -d -t barais/mdmssosies /bin/bash -xec &quot;sed -i &quot;s/172.17.0.8/$IP_REDIS/g&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/ringojs-0.10/bin/ringo /opt/mdms-ringojs/main.js&quot;)
    export IP_SOSIES=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_SOSIES`
    if [ -z &quot;$IPS_WORKER&quot; ]; then export IPS_WORKER=$IP_SOSIES; else export IPS_WORKER=&quot;$IP_SOSIES;$IPS_WORKER&quot;; fi  
done

for i in {factory_and_indirection_on_RhinoEnginerhino15 factory_and_indirection_on_RhinoEnginerhino16 factory_and_indirection_on_RhinoEnginerhino4 factory_and_indirection_on_RhinoEnginerhino5 factory_and_indirection_on_RhinoEnginerhino8 indirection_on_Streamrhino15 indirection_on_Streamrhino16 indirection_on_Streamrhino4 indirection_on_Streamrhino5 indirection_on_Streamrhino8}
do
    export ID_SOSIES=$(docker  run -i -d -t barais/mdmssosies /bin/bash -xec &quot;sed -i &quot;s/172.17.0.8/$IP_REDIS/g&quot; /opt/mdms-ringojs/config.json &amp;&amp; /opt/sosies/$i/bin/ringo /opt/mdms-ringojs/main.js&quot;)
    export IP_SOSIES=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_SOSIES`
    if [ -z &quot;$IPS_WORKER&quot; ]; then export IPS_WORKER=$IP_SOSIES; else export IPS_WORKER=&quot;$IP_SOSIES;$IPS_WORKER&quot;; fi  
done

#start some nginx and websocket server
export ID_NGINX=$(docker  run -i -d -t barais/nginxsosies /main $IPS_WORKER) #you can add a second parameter for the public name of your website e.g. cloud.diversify.org
export IP_NGINX=`docker inspect --format=&#39;{{ .NetworkSettings.IPAddress }}&#39; $ID_NGINX`
echo $IP_NGINX</code></pre></div>

<p>To go quickly, shell script are <a href="/docs/diversify/diversify.tar.gz">there</a></p>

<p>if it is for a demo, you can switch quickly between version in doing:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker kill $(docker ps -a -q) #kill all the running containers
diversify\ docker1.sh #start mdms with 10 regular backends
docker kill $(docker ps -a -q) #kill all the running containers
diversify\ docker2.sh #start mdms with 10 diversified backends
docker kill $(docker ps -a -q) #kill all the running containers
diversify\ docker3.sh #start mdms with 10 diversified backends and 10 regular backends</code></pre></div>

<p>have fun ;)</p>

                
                <!-- the comment box -->
<!--                 <div class="well">
                    <h4>Leave a Comment:</h4>
                    <form role="form">
                        <div class="form-group">
                            <textarea class="form-control" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div> -->

                <!-- the comments -->
<!--                 <hr>
 --><!--                 <h3>Start Bootstrap
                    <small>9:41 PM on August 24, 2013</small>
                </h3>
                <p>This has to be the worst blog post I have ever read. It simply makes no sense. You start off by talking about space or something, then you randomly start babbling about cupcakes, and you end off with random fish names.</p>

                <h3>Start Bootstrap
                    <small>9:47 PM on August 24, 2013</small>
                </h3>
                <p>Don't listen to this guy, any blog with the categories 'dinosaurs, spaceships, fried foods, wild animals, alien abductions, business casual, robots, and fireworks' has true potential.</p> -->

<!--             <div class="row"> -->
<!--                 % include well.html %} -->
<!--             </div> -->

<!--             </div> -->
<!--             % include well.html %} -->
            

            </div>
            <div class="col-md-4">
                <!-- <div class="col-md-4"> -->
    <!--              
    <div class="well">
        <h4>Blog Search</h4>
        <div class="input-group">
            <input type="text" class="form-control">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button">
                    <span class="glyphicon glyphicon-search"></span>
                </button>
            </span>
        </div>
    </div>
    -->

    

    <div class="well">
        <div class="row">
            <div class="col-md-6">
                <h4>Current Tags</h4>
                <ul class="list-unstyled">
                    
                    <li><a href="/blog/categories/docker/">docker</a></li> 
                    <li><a href="/blog/categories/diversify/">diversify</a></li> 
                </ul>
            </div>
        </div>
    </div>

    

    <div class="well">
        <div class="row">
            <div class="col-lg-6">
                <h4>All Tags</h4>
                <ul class="list-unstyled">
                    <li><a href="/blog/">All</a></li> 
                    <li><a href="/blog/categories/first-post/">first-post</a></li> 
                    <li><a href="/blog/categories/jekyll/">jekyll</a></li> 
                    <li><a href="/blog/categories/github-pages/">github-pages</a></li> 
                    <li><a href="/blog/categories/markdown/">markdown</a></li> 
                    <li><a href="/blog/categories/untidy/">untidy</a></li> 
                    <li><a href="/blog/categories/teaching/">teaching</a></li> 
                    <li><a href="/blog/categories/website/">website</a></li> 
                    <li><a href="/blog/categories/docker/">docker</a></li> 
                    <li><a href="/blog/categories/cloud/">cloud</a></li> 
                    <li><a href="/blog/categories/diversify/">diversify</a></li> 
                    <li><a href="/blog/categories/eclipse/">eclipse</a></li> 
                    <li><a href="/blog/categories/istic/">istic</a></li> 
                    <li><a href="/blog/categories/m2/">m2</a></li> 
                    <li><a href="/blog/categories/french/">french</a></li> 
                    <li><a href="/blog/categories/ensai/">ensai</a></li> 
                    <li><a href="/blog/categories/kevoree/">kevoree</a></li> 
                    <li><a href="/blog/categories/kevoreejs/">kevoreejs</a></li> 
                    <li><a href="/blog/categories/edison/">edison</a></li> 
                    <li><a href="/blog/categories/angularjs/">angularjs</a></li> 
                    <li><a href="/blog/categories/jquery/">jquery</a></li> 
                    <li><a href="/blog/categories/jhipster/">jhipster</a></li> 
                    <li><a href="/blog/categories/sdn/">sdn</a></li> 
                    <li><a href="/blog/categories/opendaylight/">opendaylight</a></li> 
                    <li><a href="/blog/categories/software engineering/">software engineering</a></li> 
                    <li><a href="/blog/categories/ejcp/">ejcp</a></li> 
                    <li><a href="/blog/categories/swarm/">swarm</a></li> 
                    <li><a href="/blog/categories/go-docker/">go-docker</a></li> 
                    <li><a href="/blog/categories/raspberry pi/">raspberry pi</a></li> 
                    <li><a href="/blog/categories/javascript/">javascript</a></li> 
                    <li><a href="/blog/categories/java/">java</a></li> 
                </ul>
            </div>
        </div>
    </div>

    <div class="well">
        <h4>Remark</h4>
        <p>Sorry, no comments enabled for now because I'm using a simple static site generator (maybe I'll try out disqus another day).</p>
        <p>
            But if you like what you see, send me an <a href="/contact/">email</a>.
        </p>
    </div>
<!-- </div> -->

            </div>
        </div>
    </div>

    <hr>

    <div class="banner">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <!--                     <h2>You can check me out on</h2> -->
                <h2>Find me on</h2>
            </div>
            <div class="col-lg-9">
                <ul class="list-inline banner-social-buttons">
                    <li><a href="http://www.linkedin.com/in/olivierbarais" class="btn btn-default btn-lg"><i class="fa fa-linkedin-square fa-fw"></i>
                            <span class="network-name">Linkedin</span></a></li>
                    <li><a href="https://github.com/barais" class="btn btn-default btn-lg"><i class="fa fa-github-square fa-fw"></i> <span
                            class="network-name">Github</span></a></li>
                    <li><a href="http://scholar.google.fr/citations?user=LV5i8X4AAAAJ&hl=en" class="btn btn-default btn-lg"><i
                            class="fa fa-search fa-fw"></i> <span class="network-name">Scholar</span></a></li>
                    <li><a href="https://www.google.com/+OlivierBarais?rel=author" class="btn btn-default btn-lg"><i
                            class="fa fa-google-plus-square fa-fw"></i> <span class="network-name">google+</span></a></li>
                    <li><a href="https://www.facebook.com/obarais" class="btn btn-default btn-lg"><i
                            class="fa fa-facebook-square fa-fw"></i> <span class="network-name">facebook</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->

</div>
<!-- /.banner -->

<footer>
    <div class="container">
        <div class="span12 pagination-centered" style="text-align: center">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li><a href="/">Home</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <!-- 						<li><a href="#about">About</a></li>
							<li class="footer-menu-divider">&sdot;</li>
	                    -->
                        <li><a href="/publications/">Publications</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/teaching/">Teaching</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/research/">Research</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/blog/">Blog</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/photos/">Photos</a></li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li><a href="/contact/">Contact</a></li>
                    </ul>

                    <p class="copyright text-muted small">
                        <a href="http://validator.w3.org/check?uri=referer"><img src="/img/valid-html401.png"
                            alt="Valid HTML 4.01 Frameset" height="20" width="57"></a> Built using <a href="http://jekyllrb.com/">Jekyll</a>, <a
                            href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://startbootstrap.com">Startbootstrap</a> from <a href="http://rudametw.github.io/">Walter Rudametkin's template</a>. All
                        source code available <a href="https://github.com/barais/barais.github.io"> here</a>. 
                    </p>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- Defer CSS -->
    <script type="text/javascript">
          var stylesheet = document.createElement('link');
          stylesheet.href = '/assets/main-58abab6103ee78e02cfcfa062233325f.css';
          stylesheet.rel = 'stylesheet';
          stylesheet.type = 'text/css';
          document.getElementsByTagName('head')[0].appendChild(stylesheet);
    </script>

<!-- Add custom CSS here -->
<!-- <link rel="stylesheet" href="/assets/main-58abab6103ee78e02cfcfa062233325f.css"> -->

<!-- Main Javascript -->
<!-- <script src="/assets/main-f2bda5f0801b6a41743c383e9ab4635a.js"></script> -->
<script async type="text/javascript" src="/assets/main-f2bda5f0801b6a41743c383e9ab4635a.js"></script>

<!-- <script> -->
<!-- loadStyleSheet(/assets/main-58abab6103ee78e02cfcfa062233325f.css); -->
<!-- </script> -->

<!--<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48705379-1', 'rudametw.github.io');
  ga('send', 'pageview');
</script>-->


</body>
</html>